\section{回路設計}
設計した回路について選定の理由や仕様について以下に示す．また使用する部品の一覧を\ref{tab:c_parts}に示す．
\subsection{マイコンの選定}
設計した回路を\ref{c_raspberry}，\ref{c_arduino}に示す．
マイコンとして「Raspberry Pi3 Model B（以下 RPi）」と「Arduino uno R3（以下 Arduino）」を使用する．それぞれが，統合・画像処理・モータ制御，
センサ処理，を行う．RPiでは複雑な処理を行う上で，LinuxOSの支援を受けることができ有利である．さらに，処理速度がCPU 1.2[GHz]，
メモリ1[GB]とArduinoの16[MHz]・32[KB]と比べても大きく優れている．これは，並列処理や高速な画像処理に適している．このような理由からRPi
を採用した．

また ，RPiはアナログI/Oポートを持っておらず，アナログ電圧出力を行うセンサ類の処理が困難である．そこで，アナログ・ディジタルI/Oポートを
持つArduinoにセンサ類の処理を担わせることとした．
\subsection{モータドライバ}
モータドライバは「MD10C R3」\ref{MD10C}を両輪駆動用として2つ使用し，「TA7291P」をアーム用として使用する．
各仕様を下に示す
．
[MD10C R3](駆動用)
\begin{itemize}
 \item モータ電源電圧 : DC 5[V]$〜$25[V]
 \item モータ最大電流 : 13[A]
 \item ロジック用電源 : モータ用より供給
 \item ロジック電圧   : DC 5[V] or 3.3[V]
\end{itemize}

[TA7291P](アーム用)
\begin{itemize}
 \item モータ電源電圧 : DC 0[V]$〜$20[V]
 \item モータ最大電流 : 1.0[A]
 \item ロジック電圧 : DC 4.5[V]$〜$20[V]
\end{itemize}
\begin{figure}[b]
 \centering
 \includegraphics[width=0.5\hsize]{../Circuit/picture/MD10C.eps}
    \caption{MD10C R3}
    \label{MD10C}
\end{figure}

\subsection{$I^2 C$通信}
今回，我々のロボットには測距センサを始めとする複数のセンサが搭載されている．これらの殆どがアナログ出力
であるが，ArduinoのアナログI/Oポートは6つしかなく，要求を満たしていない．

そこで，$I^2 C$通信を用いることとする．これは，$I^2 C$通信がパーティライン構成が可能となっており
,1つのマスタで複数のスレーブデバイスと通信することが可能であるからである.概要を以下に示す．
\begin{enumerate}
 \item マスタ側(Arduino)とスレーブ側(n個のセンサ等)を明確に分け，各スレーブに異なるアドレスを割り振る．
 \item マスタ側が、Start Conditionを出力し続いてアドレスとRead/Write要求を出力する.
 \item 全スレーブがこの時のSCLのクロックを元にSDAのデータを受信し、SSPADD
　　　レジスタにセットされたアドレスと一致したデバイスだけが、その後の送受信を
　　　継続する.
 \item 受信した側がデータを受信完了すると自動的にACKビットを返送し、同時にSSP割込みを発生する.
 \item これをマスタがStop Conditionを出力するまで続ける.
\end{enumerate}

\subsection{センサ仕様}
\subsubsection{赤外線測距センサ}  
測距センサは本体周囲に中距離用を7つ，前方に近距離用を3つ搭載する．これは自律行動の際に，
周辺環境，特に各種ポールを把握するために用いる． センサの仕様については実験を行ったので\ref{psdex}
 に示す．

また，各測距センサには信号のノイズを吸収し安定化させるために$0.1[\mu $F]のセラミックコンデンサを接続する．

\subsubsection{3軸加速度・ジャイロセンサモジュール}
加速度センサは[ x, y, z ]軸におけるロボットの加速度を測定するものである．

ジャイロセンサは[ x, y, z ]軸まわりの各加速度を測定するものである．

我々はこれらをロボットの自己位置推定に用いる．特にジャイロセンサについては，
ロボット本体の直進走行制御に使用する．詳細は\ref{algo}において説明する．
\begin{figure}[b]
 \centering
 \includegraphics[width=0.4\hsize]{../Circuit/picture/jairo.eps}
 \caption{3軸加速度・ジャイロセンサモジュール}
    \label{jairo}
\end{figure}
\subsection{電源回路}
電源回路は各回路図の左上に示している．\\
バッテリーはひとつしか搭載しないが，RPiとArduinoでは定格電流値が異なるために同一の電源は使用できない．
そこで，それぞれに降圧レギュレータとしてDCDCコンバータを用いてバッテリーからの供給電源を
分電することとした．各仕様を下に示す．


\begin{description}
 \item[【LR8697】(RPi・モータ用)] \mbox{} \\
	    電源電圧 : DC 6.0[V]$〜$42.0[V]] \\
	    出力電圧 : DC 5.0[V] \\
	    出力電流 : 2.5[A]
 \item[【BTD05-05S200D】(Arduino・センサ用)] \mbox{} \\
	    電源電圧 : 4.5$〜$9.0[V] \\
	    出力電圧 : 5.0[V] \\
	    出力電流 : 2000[mA]
\end{description}

\begin{table}[hb]
  \centering
  \caption{回路用部品表}
  \begin{tabular}{|c|c|r||c|} \hline
    タイプ & 部品名 & 数 & 用途 \\ \hline \hline
     マイコン & Raspberry Pi3 & 1& 統括・画像処理・モータ制御 \\ \cline{2-4}
   　　& Arduino uno R3& 1 & センサ類の処理 \\ \hline
     DCモータ & AO-8014 & 2 & 駆動用 \\ \cline{2-4}
      & TAMIYA ミニモータ & 1&アーム用  \\ \hline
    モータドライバ& MD10C-R3 & 2& タイヤ用 \\ \cline{2-4}
      &  TA7291P&1 &アーム用 \\ \hline
     赤外線測距センサ& GP2Y0A02YK &6&中距離センサ\\ \cline{2-4}
       &GP2Y0E03&3&近距離センサ \\ \hline
     カメラモジュール&P5V04A&1&画像処理\\ \hline
     3軸加速度センサ&KXR94-2050&1&自己位置推定\\ \hline
     3軸ジャイロセンサ&BGD20&1&自己位置推定\\ \hline
    DCDCコンバータ&LT8697&1& 7.2[V]→5.0[v]2500[mA]降圧レギュレータ\\ \cline{2-4}
       &BTD05-05S200D&1&7.2[V]→5.0[V]2000[mA]降圧レギュレータ\\ \hline
    コンデンサ&電解コンデンサ 47[$\mu$F]&2&電源安定化\\ \cline{2-4}
            &セラミックコンデンサ 0.1[$\mu$F]&9&センサ信号安定化\\ \hline
　　バッテリー&POWER MAX 4000 Ni-MH&1&電源バッテリー 7.2[V]4200[mAh]\\ \hline
                 
  \end{tabular}
  \label{tab:c_parts}
\end{table}

\newpage
\begin{figure}[H]
 \centering
 \includegraphics[width=0.9\hsize]{../Circuit/picture/RCR_raspberryPi3.eps}
    \caption{Raspberry Pi3 接続回路図}
    \label{c_raspberry}
\end{figure}
\begin{figure}[H]
 \centering
 \includegraphics[width=0.9\hsize]{../Circuit/picture/RCR_arduino.eps}
    \caption{Arduino unoR3 接続回路図}
    \label{c_arduino}
\end{figure}
